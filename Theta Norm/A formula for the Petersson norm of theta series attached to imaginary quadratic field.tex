\documentclass[twoside,10pt]{article}

\usepackage{amsmath, amssymb, amsthm}
\usepackage[top=1in, left=1.25in, right=1in, bottom=1in]{geometry}%Pour des pages plus larges
\renewcommand*\familydefault{\sfdefault}%Pour des lettres sans serif

\usepackage{graphicx}%Pour les images

\usepackage[pdftex,bookmarks,colorlinks,breaklinks]{hyperref} 
\hypersetup{linkcolor=blue,citecolor=red,filecolor=dullmagenta,urlcolor=darkblue}

%\usepackage{palatino}%Pour utiliser l'écriture Palatino
\usepackage{euler}%Change l'aspect des formules mathématiques

\usepackage{multirow}

\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{prop}{Proposition}
\newtheorem{defn}{Definition}
\newtheorem{coro}{Corollary}

\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}

\newcommand{\rarr}{\rightarrow}
\newcommand{\esp}{\hspace{1cm}}
\newcommand{\for}{\hspace{1cm}\textrm{for }}
\newcommand{\where}{\hspace{1cm}\textrm{where }}
\newcommand{\Res}{\textrm{Res}}
\newcommand{\LT}{\textrm{LT}}
\newcommand{\Gal}{\text{Gal}}

\newcommand{\dashk}{\vert_{k}}
\renewcommand{\H}{\mathcal{H}}
\newcommand{\M}{\mathcal{M}}
\renewcommand{\S}{\mathcal{S}}
\newcommand{\G}{\Gamma}
\newcommand{\SL}{\textrm{SL}_2(\mathbb{Z})}
\newcommand{\m}{\mathfrak{m}}
\newcommand{\p}{\mathfrak{p}}
\newcommand{\ida}{\mathfrak{a}}
\newcommand{\idb}{\mathfrak{b}}
\newcommand{\idc}{\mathfrak{c}}
\newcommand{\idd}{\mathfrak{d}}
\newcommand{\del}{\partial}
\newcommand{\Clk}{\text{Cl}_K}
\newcommand{\ord}{\text{ord}}
\renewcommand{\O}{\mathcal{O}}

\renewcommand{\d}{\text{d}}
%\newcommand{\Im}{\mathfrak{I}}
%\newcommand{\Re}{\mathfrak{R}}


\newcommand{\tpsi}{\theta_\psi}
\newcommand{\tida}{\theta_\mathfrak{a}}
\newcommand{\runi}{w_K}
\newcommand{\latbasis}{[\omega_1,\omega_2]}
\newcommand{\omquot}{\omega_1/\omega_2}

\author{Nicolas Simard}
\date{\today}
\title{Petersson norm of theta series and derivatives of Eisenstein series}

\begin{document}
\maketitle
\tableofcontents

\section*{Introduction}
In these notes, we find a formula for the Petersson norm of the theta series $\tpsi$ attached to an imaginary quadratic field $K$ and a Hecke character of infinity type $2\ell$. The formula is
\[\langle\tpsi,\tpsi\rangle=V_D^{-1}(|D|/4)^\ell\frac{4h_K}{w_K^2}\sum_{[\ida]\in\Clk}\psi^2(\ida)\del_2^{2\ell-1}E_{2}(\ida)\]
if $\ell>0$ and
\[\langle\tpsi,\tpsi\rangle =-V_D^{-1}\frac{4h_K}{w_K^2}\sum_{[\ida]\in\Clk}\psi^2(\ida)\log(\Im(\tau_\ida)^{1/2}|\eta(\tau_\ida)|^2)\]
if $\ell=0$ and $\psi$ is not a genus character. Here $\del_2^{2\ell-1}E_2$ is the non-holomorphic derivative of the non-holomorphic Eisenstein series of weight $2$ and level $1$, viewed as a function on lattices in the usual way, and
\[V_D = \text{Vol}(\Gamma_0(|D|)\setminus\H)=\frac{\pi}{3}|D|\prod_{p|D}(1+p^{-1}).\]
In the last section, we will see that one can make sense of the first formula even for $\ell=0$ and that it gives back exactly the second formula!

Before proving the formula, we first recall a few facts about Hecke characters, Eisenstein series and the Rankin-Selberg method. Then we introduce the theta functions $\tpsi$. In the following section, we show how the Petersson norm of the $\tpsi$ is related to the Hecke $L$-function of $\psi^2$. Finally, we relate the Hecke $L$-function of $\psi^2$ to non-holomorphic Eisenstein series and use this relation to establish the two formulas.

If $\psi$ is a genus character, $\tpsi$ is an Eisenstein series and one should use the regularized Petersson inner product. I think a similar formula holds. I will try this soon.

\section{Setup and notation}
Throughout, $K=\Q(\sqrt{D})$ denotes an imaginary quadratic field of discriminant $D<-4$ and $\O_K$ denotes its ring of integers.

\section{Preliminaries}
\subsection{Hecke Grossencharacters}
Let $I_K$ be the multiplicative group of fractional ideals of $K$. Given an integer $\ell\geq 0$, let $\psi_\ell$ denote a \emph{Hecke Grossencharacter} of conductor $1$ and infinity type $2\ell$, that is a group homomorphism
\[\psi_\ell:I_K\rarr \C^\times\]
such that
\[\psi_\ell((\alpha))=\alpha^{2\ell},\esp\forall \alpha\in K^\times.\]
Note that this is well-defined since $\O_K^\times = \{\pm1\}$ by assumption.

Those Hecke characters are not of the form considered in the books of Miyake \cite[Ch. 3, Sec. 3]{Miya} or Iwaniec \cite[Ch. 12, Sec. 2]{Iwan}. For clarity, we call the ones they define \emph{unitary}. Let $N:I_K\rarr \Q$ denote the norm map on ideals. Then the character
\[\psi_\ell N^{-\ell}:I_K\rarr \C^\times\]
is unitary of conductor $1$ and of infinity type $2\ell$ (take $u_\sigma+iv_\sigma=2\ell$ in their definition, where $\sigma:K\hookrightarrow\C$ is a complex embedding). 

To a Hecke character $\psi$ (unitary or not), one attaches the Dirichlet $L$-series
\[L(\psi,s) = \sum_\ida \frac{\psi(\ida)}{N(\ida)^s},\]
which converges for $s$ in some right-half plane in $\C$. Clearly, multiplying $\psi$ with a power of the norm $N^\ell$ simply shifts the $L$-function by $\ell$:
\[L(\psi,s-\ell)=L(\psi\circ N^\ell,s).\]
Define the completed $L$-function of $L(\psi_\ell,s)$ as
\[\Lambda(\psi_\ell,s)=|D|^{s/2}(2\pi)^{-s}\Gamma(s)L(\psi_\ell,s).\]

\begin{theorem}[Hecke]
\begin{enumerate}
	\item $\Lambda$ can be analytically continued to a meromorphic function on $\C$ and satisfies the functional equation
\[\Lambda(\psi_\ell,s)=w(\psi_\ell)\Lambda(\overline{\psi_\ell},2\ell+1-s),\]
where $|w(\psi_\ell)|=1$.%Compute $w(\psi_\ell)$ explicitly?
	\item $\Lambda(\psi_\ell,s)$ is holomorphic on $\C$, except when $\psi_\ell$ is the trivial character (this can only happen when $\ell = 0$), in which case is has a pole at $s=0$ and $s=1$.
	\item $L(\psi_\ell,s)$ is holomorphic on $\C$, except when $\psi_\ell$ is the trivial character, in which case it has a pole at $s=1$ with residue
	\[\frac{2\pi h_K}{\runi \sqrt{|D|}},\]
	where $h_K$ is the class number of $K$ and $\runi=2$ is the number of roots of unity in $K$.
\end{enumerate}
\end{theorem}
\begin{proof}
	See \cite[Ch. 3, Sec. 3]{Miya}.
\end{proof}


\subsection{Eisenstein series: holomorphic and non-holomorphic}\label{sec:Eisen}
Eisenstein series will be useful in many ways in these notes. Recall that they can be defined in essentially two (closely related) ways: as Poincare series and as sum over lattice points. The first type is used in the Rankin-Selberg method, while the second is linked to Hecke $L$-functions of imaginary quadratic fields. We recall a few basic facts about these series. Our main references are \cite[Ch.9]{Shi1}, \cite[A3]{Shi1} and \cite[Ch.7]{Miya}

Let $N\geq 1$ and $k\geq 0$ be integers. As usual, define
\[\Gamma_0(N)=\left \{\begin{pmatrix}
a & b \\ 
c & d
\end{pmatrix} :c\equiv 0\pmod N\right \}\]
and for $f:\H\rarr\C$ a function on the upper half plane and $\gamma\in\SL$, define the slash-k as operator
\[(f\vert_k\gamma)(z)=j(\gamma,z)^{-k}f(\gamma z),\]
where $\SL$ acts on $\H$ in the usual way and
\[j\left (\begin{pmatrix}
a & b \\ 
c & d
\end{pmatrix},z\right )=cz+d.\]
Let also $\Gamma_\infty$ be the stabilizer of the cusp at infinity in $\SL$, i.e.
\[\Gamma_\infty=\left \{\pm\begin{pmatrix}
1 & m \\ 
0 & 1
\end{pmatrix} :m\in\Z\right \}\]

%As in Shimura for N=1, p=q=0
For $(z,s)\in\H\times\C$, define the \emph{non-holomorphic Eisenstein series of weight $k$} as
\[G_k(z,s)=\Im(z)^s\sum_{m,n}(mz+n)^{-k}|mz+n|^{-2s},\]
where the sum is over all integers $m$ and $n$, not both $0$. This sum converges for $\Re(2s)+k>2$.

Since
\[\Im(\gamma z)^s=|j(\gamma,z)|^{-2s}\Im(z)^s,\]
the non-holomorphic Eisenstein series satisfies the following functional equation:
\[G_k(\gamma z,s)=j(\gamma,z)^kG_k(z,s).\]
In particular, $k$ must be even.

For $k>2$, the series converges absolutely at $s=0$ and equals the usual Eisenstein series of weight $k$ and level $1$. For $k=2$, it does not converge absolutely at $s=0$. However, for $k>0$ there is a real analytic function of $(z,s)\in\H\times\C$ which is holomorphic in $s$ and coincides with $\Gamma(s+k)G_k(z,s)$ for $\Re(2s)+k>2$ (\cite[Thm A3.5]{Shi1}). Therefore it still makes sense to consider $G_2(z,0)$. Define
\[E_2(z)=2^{-1}(2\pi i)^{-2}G_2(z,0).\]
Then $E_2$ is  an \emph{almost holomorphic} modular form of weight $2$ and level $1$ with Fourier expansion
\[E_2(z)=\frac{1}{8\pi\Im(z)}-\frac{1}{24}+\sum_{n=1}^\infty\sigma_1(n)q^n,\]
which clearly has algebraic Fourier coefficients. Almost holomorphic modular forms are defined as in \cite[Sec. 5.3]{Zag}\footnote{Shimura calls those functions nearly holomorphic in \cite{Shi1}, but we prefer to use this term to refer to modular forms with (possibly) poles at infinity.}. In particular,
\[E_2\vert_2\gamma=E_2,\esp\forall\gamma\in\SL.\]

Consider now the following Eisenstein series:
\[E_k^N(z,s)=\sum_{\gamma\in\Gamma_\infty\setminus\Gamma_0(N)}\Im(z)^s\dashk\gamma=Im(z)^s\sum_{\gamma\in\Gamma_\infty\setminus\Gamma_0(N)}j(\gamma,z)^{-k}|j(\gamma,z)|^{-2s}.\]
This series also converges absolutely for $\Re(2s)+k>2$ and can be analytically continued to a holomorphic function in $s$, except when $k=0$, in which case $E_0^N(z,s)$ has a pole at $s=1$ with residue
\[\Res_{s=1}E_0^N(z,s)=\text{Vol}(\Gamma_0(N)\setminus\H)^{-1}.\]


%In the region of convergence, the sum defining $G_k^N(z,s)$ can be rearranged as follows
%\[\Im(z)^s\sum_{m,n}'(mz+n)^{-k}(mz+n)^{-2s}=\Im(z)^s\sum_{r=1}^\infty\sum_{(m,n)=r,m\equiv 0\pmod N}(mz+n)^{-k}(mz+n)^{-2s}\]
%\[=2\zeta(k+2s)\Im(z)^s\sum_{(c,d)=1,c\equiv0\pmod N,d>0}(cz+d)^{-k}(cz+d)^{-2s},\]
%where we are using the fact that $k$ is even and $\zeta(s)$ is the Riemann zeta function. The map
%\[\begin{pmatrix}
%* & * \\ 
%c & d
%\end{pmatrix} \mapsto(c,d)\]
%induces a bijection between $\Gamma_\infty\setminus\Gamma_0(N)$ and the set
%\[\{(c,d)\in\Z^2:(c,d)=1,c\equiv0\pmod N,d>0\}\]
%(\cite[Lemma 7.1.6]{Miya}), so the above computation proves that
%\[2\zeta_N(k+2s)G_k^N(z,s)=E_k^N(z,s),\]
%where $E_k^N(z,s)$ is defined as

\subsection{Rankin-Selberg method in level $N$}
The Rankin-Selberg is well-known. We sketch it here mainly to make sure that the normalizations are correct. Our main reference is \cite{Shi2}.

Let $f(z),g(z)\in\S_k(\Gamma_0(N),\chi)$ be two cusp forms of weight $k$, level $N$ and Nebentypus $\chi$. Then the function
\[F(z)=f(z)\overline{g(z)}\Im(z)^k\]
if $\Gamma_0(N)$-invariant and tends to $0$ rapidly as $\Im(z)$ tends to $\infty$, so it makes sense to define the \emph{Petersson inner product} of $f$ and $g$ as
\[\langle f,g\rangle=\frac{1}{\text{Vol}(\Gamma_0(N)\setminus\H)}\int\int_{\Gamma_0(N)\setminus\H}F(z)\d\mu(z),\]
where we integrate over a fundamental domain for the action of $\Gamma_0(N)$ on $\H$ and
\[\d\mu(z)=\frac{\d x\d y}{y^2}\]
is the $\SL$-invariant measure on $\H$.

Now for $\Re(s)$ large enough, the series for $E_0^N(z,s)$ converges absolutely and the following manipulations are justified:
\begin{align*}
\int\int_{\Gamma_0(N)\setminus\H}F(z)E_0^N(z,s)\d\mu(z) &=\int\int_{\Gamma_0(N)\setminus\H}\sum_{\gamma\in\Gamma_\infty\setminus\Gamma_0(N)}F(z)\Im(\gamma z)^s\d\mu(z)\\
														&=\sum_{\gamma\in\Gamma_\infty\setminus\Gamma_0(N)}\int\int_{\Gamma_0(N)\setminus\H}F(\gamma z)\Im(\gamma z)^s\d\mu(z)\\
														&=\int\int_{\Gamma_\infty\setminus\H}F(z)\Im(z)^s\d\mu(z)\\
\end{align*}

As a functions of $s$, the last integral has a residue at $s=1$. Using the value of $\Res_{s=1}E^N_0(z,s)$ given above, one sees that
\[\Res_{s=1}\int\int_{\Gamma_\infty\setminus\H}F(z)\Im(z)^s\d\mu(z)=\Res_{s=1}\int\int_{\Gamma_0(N)\setminus\H}F(z)E_0^N(z,s)\d\mu(z)=\langle f,g\rangle.\]
Note that it is important that $\Res_{s=1}E^N_0(z,s)$ does not depend on $z$.

On the other hand, let
\[f(z)=\sum_{n=1}^\infty a_nq^n\esp\text{and}\esp g(z)=\sum_{n=1}^\infty b_nq^n\]
be the $q$-expansions of $f$ and $g$. Then
\[f(z)\overline{g(z)}=\sum_{m,n=1}^\infty a_n\overline{b_m}e^{2\pi inz}e^{-2\pi i m\bar{z}}=\sum_{m,n=1}^\infty a_n\overline{b_m}e^{2\pi i(n-m)x}e^{-2\pi (m+n)y},\]
where $z=x+iy$, so 
\[\int_0^1F(z)\Im(z)^s\d x=\sum_{n=1}^\infty a_n\overline{b_n}e^{-4\pi ny}y^{k+s}\]
and
\[\int\int_{\Gamma_\infty\setminus\H}F(z)\Im(z)^s\d\mu(z)=\int_0^\infty\left (\int_0^1F(z)\Im(z)^s\d x\right )\frac{\d y}{y^2}=\frac{\Gamma(s+k-1)}{(4\pi)^{s+k-1}}\sum_{n=1}^\infty\frac{a_n\overline{b_n}}{n^{s+k-1}}.\]

Comparing the expressions for
\[\Res_{s=1}\int\int_{\Gamma_\infty\setminus\H}F(z)\Im(z)^s\d\mu(z),\]
gives the formula
\begin{equation}\label{RankinSelberg}
	\langle f,g\rangle=\Gamma(k)(4\pi)^{-k}Res_{s=k}D(f,g_\rho,s),
\end{equation}
where
\[D(f,g,s)=\sum_{n=1}^\infty\frac{a_nb_n}{n^{s}}\]
and
\[g_\rho(z)=\overline{g(-\bar{z})}=\sum_{n=1}^\infty \overline{b_n} q^n.\]

\section{Theta series attached to imaginary quadratic fields}
Let $\ell\geq 0$ and $\psi=\psi_\ell$ be a Hecke character of infinity type $2\ell$. Consider the theta series
\[\tpsi(z)=\sum_{\ida}\psi(\ida)q^{N(\ida)},\]
where the sum runs over all integral ideals of $\O_K$. It is well known (\cite[Thm. 12.5]{Iwan}) that
\[\tpsi(z)\in M_{2\ell+1}(\Gamma_0(|D|),\chi_D),\]
where $\chi_D$ is the quadratic character attached to $K$ (i.e. the Kronecker symbol).\footnote{Note that the Hecke characters $\psi_\ell$ have conductor $\O_K$, so they are automatically primitive.}

If $\ell>0$, $\tpsi$ is in fact a cusp form. If $\ell=0$, this is also true, unless $\psi$ is a genus character (i.e. $\psi^2=1$), in which case it is an Eisenstein series. In any case,
\[L(\tpsi,s)=L(\psi,s),\]
so the $L$-function of $\tpsi$ has an Euler product\footnote{One reason to choose the non-unitary Hecke characters $\psi_\ell$ is to have simpler formulas, like this one.}. It follows that $\tpsi$ is a normalized (i.e. $a_1(\tpsi)=1$) eigenform for all Hecke operators (see \cite[Thm. 5.9.2]{DiSh}). Moreover,
\[a_n(\tpsi)=\sum_{N(\ida)=n}\psi(\ida),\]
where the sum is over all integral ideals of $K$ of norm $n$. It follows that
\[a_p(\tpsi)=\begin{cases}
	0	&\text{if } \chi_D(p)=-1\\
	\psi(\p)+\psi(\bar{\p}) &\text{if } \chi_D(p)=1 \text{ and }p\O_K=\p\bar{\p}\\
	\psi(\p)&\text{if }  \chi_D(p)=0 \text{ and }p\O_K=\p^2\\
\end{cases},\]
in accordance with the equality between the $L$-functions of $\tpsi$ and $\psi$.

Using the fact that the adjoint of the Hecke operators $T_p$ acting on $S_{2\ell+1}(\Gamma_0(|D|),\chi_D)$ with respect to the Petersson inner product is
\[T_p^*=\overline{\chi_D}(p)T_p\]
for all $p$ not dividing $D$ (see \cite[Thm. 5.5.3]{DiSh}), one sees that 
\[a_p(\tpsi)=\chi_D(p)\overline{a_p(\tpsi)}\]
for all $p$ not dividing $D$, whenever $\tpsi$ is a cusp form.

\begin{lemma}\label{realFourrier}
	\[a_n(\tpsi)\in\R\]
	whenever $\tpsi$ is a cusp form.
\end{lemma}
\begin{proof}
	By the multiplicativity property of the $a_n(\tpsi)$, it suffices to prove the result for $n=p^k=$a prime power. Recall that
	\[a_{p^{k+1}}(\tpsi)=a_{p}(\tpsi)a_{p^k}(\tpsi)-\chi_D(p)p^{2\ell}a_{p^{k-1}}(\tpsi),\]
	for all $k\geq1$.
	
	If $p$ is inert in $K$, $a_p(\tpsi)=0$ and so $a_{p^k}(\tpsi)=0$ for all $k\geq 0$.
	
	If $p$ splits in $K$, $a_{p}(\tpsi)=\chi_D(p)\overline{a_{p}(\tpsi)}=\overline{a_{p}(\tpsi)}$, so $\overline{a_{p}(\tpsi)}\in\R$ and the claim follows from the recursive formula.
	
	Finally if $p$ ramifies, say $p\O_K=\p^2$, then $a_{p}(\tpsi)=\pm p^\ell$ since
	\[p^{2\ell}=\psi((p))=\psi(\p^2)=\psi(\p)^2\]
	and the claim follows again from the recursive formula.
\end{proof}

\section{The Petersson norm of $\tpsi$}
In this section, suppose $\tpsi$ is a cusp form, i.e. $\psi^2\neq 1$. We will prove that the Petersson norm of $\tpsi$ is
\begin{equation}\label{NormLpsi}
\langle\tpsi,\tpsi\rangle=V_D^{-1}\frac{4h_k}{w_k}\sqrt{|D|}\frac{\Gamma(2\ell+1)}{(4\pi)^{2\ell+1}}L(\psi^2,2\ell+1),
\end{equation}
where $V_D=\text{Vol}(\Gamma_0(|D|)\setminus\H)$, as before.

Note that if $\psi^2=1$, $\ell=0$ and so $L(\psi^2,s)$ has a pole at $s=1$.

For each prime $p$, the $L$-function of $\tpsi$ has Euler factor at $p$ equal to
\[1-a_p(\tpsi)p^{-s}+\chi_D(p)p^{2l-2s}=(1-\alpha_pp^{-s})(1-\beta_pp^{-s}),\]
where we set $\beta_p=0$ if $p|D$. One can then define the symmetric square $L$-function of $\tpsi$ as
\[L(\text{Sym}^2\tpsi,s)=\prod_{p}((1-\alpha_p^2p^{-s})(1-\alpha_p\beta_pp^{-s})(1-\beta_p^2p^{-s}))^{-1}\]
for $\Re(s)$ large enough. This $L$-function can be analytically continued to a meromorphic funtion on the whole complex plane, with (possibly) poles at $s=2\ell$ and $s=2\ell+1$ (see \cite[Thm. 2]{Shi2}).

Using the description of $a_p(\tpsi)$ given in the previous section, one sees that
\[\{\alpha_p,\beta_p\}=\begin{cases}
	\{\pm p^\ell,\mp p^\ell\}	&\text{if } \chi_D(p)=-1\\
	\{\psi(\p),\psi(\bar{\p})\}&\text{if } \chi_D(p)=1 \text{ and }p\O_K=\p\bar{\p}\\
	\{\psi(\p),0\}&\text{if }  \chi_D(p)=0 \text{ and }p\O_K=\p^2\\
\end{cases}.\]

The proof of formula \ref{NormLpsi} relies on the Rankin-Selberg method:
\[\langle\tpsi,\tpsi\rangle=(4\pi)^{-2\ell-1}\Gamma(2\ell+1)\Res_{s=2\ell+1}D(\tpsi,\tpsi,s),\]
where we used the fact that $\tpsi$ has real Fourrier coefficients (Lemma \ref{realFourrier}). Before proving the formula, we mention the following Lemma of Shimura (see \cite[Ch.3, Lem.1]{Shi3}).

\begin{lemma}
	Suppose we have formally
	\[\sum_{n=1}^\infty\frac{a_n}{n^s}=\prod_{p}((1-\alpha_pp^{-s})(1-\beta_pp^{-s}))^{-1},\]
	\[\sum_{n=1}^\infty\frac{b_n}{n^s}=\prod_{p}((1-\alpha_p'p^{-s})(1-\beta_p'p^{-s}))^{-1}.\]
	Then
	\[\sum_{n=1}^\infty\frac{a_nb_n}{n^s}=\prod_{p}(1-\alpha_p\beta_p\alpha_p'\beta_p'p^{-2s})((1-\alpha_p\alpha_p'p^{-s})(1-\alpha_p\beta_p'p^{-s})(1-\beta_p\alpha_p'p^{-s})(1-\beta_p\beta_p'p^{-s}))^{-1}.\]
\end{lemma}

The first step in the proof is the following.

\begin{lemma}
	For all $s$, one has
	\[\zeta_D(2s-4\ell)D(\tpsi,\tpsi,s)=L(\textrm{Sym}^2\tpsi,s)L(\chi_D,s-2\ell),\]
	where $\zeta_D(s)$ is the usual Riemann zeta function with the Euler factors at $p|D$ removed and $L(\chi_D,s)$ is the Dirichlet $L$-function attached to $\chi_D$.
\end{lemma}
\begin{proof}
	The idea is to compare the Euler factors at each prime on each side for $\Re(s)$ large enough, using Shimura's lemma.
	
	For $p$ split or inert, the Euler factor on the left simplifies to
	\[(1-p^{4\ell-2s})^{-1}(1-p^{4\ell-2s})((1-\alpha_p^2p^{-s})(1-\alpha_p\beta_pp^{-s})(1-\beta_p^2p^{-s}))^{-1}(1-\chi_D(p)p^{2\ell-s})^{-1},\]
	while the one on the right is
	\[((1-\alpha_p^2p^{-s})(1-\alpha_p\beta_pp^{-s})(1-\beta_p^2p^{-s}))^{-1}(1-\chi_D(p)p^{2\ell-s})^{-1}.\]
	
	If $p$ ramifies, $\beta_p=0$ and $\chi_D(p)=0$. Then the Euler factor on the left is
	\[(1-p^{2\ell-s})^{-1},\]
	which is also equal to the one on the right.	
\end{proof}

The last step is to relate $L(\textrm{Sym}^2\tpsi,s)$ to $L(\psi^2,s)$.

\begin{lemma}
	For all $s$, one has
	\[L(\textrm{Sym}^2\tpsi,s)=L(\psi^2,s)\zeta_D(s-2\ell).\]
\end{lemma}
\begin{proof}
	Again, it suffices to compare the euler factors on both sides for $\Re(s)$ large enough.
	
	If $p$ is inert, the Euler factor on the left is
	\[((1-p^{2\ell-s})(1+p^{2\ell-s})(1-p^{2\ell-s}))^{-1},\]
	while the one on the right is
	\[(1-\psi^2((p))p^{-2s})^{-1}(1-p^{2\ell-s})^{-1}=(1-p^{4\ell-2s})^{-1}(1-p^{2\ell-s})^{-1}.\]
	
	If $p$ splits as $p\O_K=\p\bar{\p}$, the Euler factor on the left is
	\[(1-\psi^2(\p)p^{-s})(1-\psi(\p)\psi(\bar{\p})p^{-s})(1-\psi^2(\bar{\p})p^{-s}))^{-1}=((1-\psi^2(\p)p^{-s})(1-\psi^2(\bar{\p})p^{-s}))^{-1}(1-p^{2\ell-s})^{-1},\]
	which is clearly equal to the one on the right.
	
	The case $p$ ramified is similar.
\end{proof}

Putting those two lemmas together gives
\[\zeta_D(2s-4\ell)D(\tpsi,\tpsi,s)=L(\chi_D,s-2\ell)\zeta_D(s-2\ell)L(\psi^2,s).\]
By taking residues on both sides of this equation at $s=2\ell+1$ and using the fact that $L(\psi^2,s)$ is analytic at $2\ell+1$,
\[\Res_{s=2\ell+1}\zeta_D(s-2\ell)=\prod_{p|D}(1-p^{-1})\Res_{s=1}\zeta(s)=\prod_{p|D}(1-p^{-1})\]
and
\[\zeta_D(2)=\prod_{p|D}(1-p^{-2})\zeta(2),\]
we get
\[\langle\tpsi,\tpsi\rangle=\zeta(2)^{-1}\frac{\Gamma(2\ell+1)}{(4\pi)^{2\ell+1}}L(\chi_D,1)\prod_{p|D}(1+p^{-1})^{-1}L(\psi^2,2\ell+1).\]
Using the Dirichlet class number formula for $L(\chi_D,1)$ gives Formula \ref{NormLpsi}.

\section{Special values of Hecke L-functions and Eisenstein series}
In this section, we first relate $L(\psi^2,s)$ to non-holomorphic Eisenstein series. Then we use this relation to express the special value of $L(\psi^2,s)$ at $2\ell+1$ in terms of derivatives of $E_2$ evaluated at $CM$ points when $\ell>0$. The case $\ell=0$ is different and must be treated separately.

Throughout this section, fix a Hecke character $\psi$ of $K$ of infinity type $2\ell$.

\subsection{Hecke $L$-functions and non-holomorphic Eisenstein series}
Recall that is $f$ is a $\dashk\gamma$-invariant function for all $\gamma$ in $\SL$, then one can define a weight $k$ homogeneous function $F$ on the space of (positively) oriented lattices in $\C$ as
\[F(\omega_1\Z+\omega_2\Z)=\omega_2^{-k}f(\omega_1/\omega_2).\]
Recall that an oriented lattice is a lattice $\ida$ equipped with a $\Z$-basis $\latbasis$, where the order of the basis elements is important. If $\Im(\omquot)>0$, $\ida$ is called positively oriented. If the $\Z$-basis $\latbasis$ is not positively oriented, the basis $[\omega_2,\omega_1]$ is, so that any lattice $\ida$ can be positively oriented. The point $\omquot\in\H$ attached to a positively oriented basis of $\ida$ will sometimes be denoted $\tau_\ida$. Note that we do not make any holomorphy assumptions on $f$.

Recall that he non-holomorphic Eisenstein series $G_k(z,s)$ of weight $k$ is defined as
\[G_k(z,s)=\Im(z)^s\sum_{m,n}(mz+n)^{-k}|mz+n|^{-2s},\]
where the sum runs over all integers $m$ and $n$ not both $0$. If $\ida$ is any fractional $\O_K$-ideal with oriented basis $\latbasis$, define
\[G_k(\ida,s)=\omega_2^{-k}\left (\frac{\sqrt{|D|}N(\ida)}{2}\right )^{-s}G_k(\omquot,s),\]
where $D$ is the discriminant of $K$. To see that this definition makes sense, first note that
\[\Im(\omquot)=|\omega_2|^{-2}\left (\frac{\sqrt{|D|}N(\ida)}{2}\right ).\]
Then
\[G_k(\ida,s)=\sum_{m,n}(m\omega_1+n\omega_2)^{-k}|m\omega_1+n\omega_2|^{-2s},\]
so that $G_k(\ida,0)$ is the usual weight $k$ Eisenstein series on lattices for $k>2$. Moreover,
\[G_k(\mu\ida,s)=\mu^{-k}|\mu|^{-2s}G_k(\ida,s)\]
for any $\mu\in K^\times$.

Consider now the following partial Hecke $L$-function
\[L^{(2\ell)}(\ida,s)=\sum_{\lambda\in\ida-{0}}\frac{\overline{\lambda}^{2\ell}}{|\lambda|^{2s}}.\]
The first basic relation between Eisenstein series and Hecke $L$-functions is based on the following
\begin{prop}\label{eq:partialdec}
	Let $\psi$ be a Hecke character of infinity type $2\ell$ as above. Then
	\[L(\psi,s)=\frac{1}{w_K}\sum_{[\ida]\in\Clk}\frac{\psi(\ida)}{N(\ida)^{2\ell-s}}L^{(2\ell)}(\ida,s),\]
	where the sum runs over (any choice of) representatives of the ideal class group of $K$. 
\end{prop}
\begin{proof}
	The fact that the sum does not depend on the choice of representatives of $\Clk$ follows from the fact that
	\[L^{(2\ell)}(\mu\ida,s)=\overline{\mu}^{-2\ell}|\mu|^{-2s}L^{(2\ell)}(\ida,s).\]
	To prove formula, first write
\[L(\psi,s)=\sum_{[\ida]\in\Clk}\sum_{\idc\in[\ida]}\frac{\psi(\idc)}{N(\idc)^s},\]
where the inner sum runs over the integral ideals $\idc$ in the class of $\ida$. Now fix $\idb\in[\ida]^{-1}$ such that $1\in\idb$. Then $\idc\in[\ida]$ with $\idc\subseteq\O_K$ if and only if $\idc\idb=\lambda\O_K$ with $\lambda\in\idb$. Note that $\lambda$ is unique up to an element of $\O_K^\times$ and $N(\idc)=N(\lambda)N(\idb)^{-1}$. It follows that
\[\sum_{\idc\in[\ida]}\frac{\psi(\idc)}{N(\idc)^s}=\frac{1}{w_K}\frac{N(\idb)^s}{\psi(\idb)}\sum_{\lambda\in\idb}\frac{\lambda^{2\ell}}{|\lambda|^{2s}}.\]
Since $\ida\bar{\ida}=N(\ida)\O_K$, one can take $\idb=\bar{\ida}N(\ida)^{-1}$ (which contains $1$) and then a short computation shows that the previous formula becomes
\[\sum_{\idc\in[\ida]}\frac{\psi(\idc)}{N(\idc)^s}=\frac{1}{w_K}\frac{N(\idb)^s}{\psi(\idb)}\sum_{\lambda\in\idb}\frac{\lambda^{2\ell}}{|\lambda|^{2s}}=\frac{1}{w_K}\frac{\psi(\ida)}{N(\ida)^{2\ell-s}}\sum_{\lambda\in\ida}\frac{\bar{\lambda}^{2\ell}}{|\lambda|^{2s}}=\frac{1}{w_K}\frac{\psi(\ida)}{N(\ida)^{2\ell-s}}L^{(2\ell)}(\ida,s).\]
\end{proof}

Since
\[L^{(2\ell)}(\ida,s)=G_{2\ell}(\ida,s-2\ell),\]
we obtain

\begin{coro}\label{eq:Eisensteindec}
	Let $\psi$ be a Hecke character of infinity type $2\ell$ as above. Then
	\[L(\psi,s)=\frac{1}{w_K}\sum_{[\ida]\in\Clk}\frac{\psi(\ida)}{N(\ida)^{2\ell-s}}G_{2\ell}(\ida,s-2\ell)=\frac{1}{w_K}\left (\frac{2}{\sqrt{|D|}}\right )^{s-2\ell}\sum_{[\ida]=[\latbasis]}\frac{\psi(\ida)}{\omega_2^{2\ell}}G_{2\ell}(\omquot,s-2\ell),\]
	where the first sum runs over (any choice of) representatives of the ideal class group of $K$ and in the second one, $\latbasis$ is a positively oriented basis of $\ida$. 
\end{coro}

\subsection{The case $\ell=0$: kronecker limit formula}
When $\ell=0$, Corollary \ref{eq:Eisensteindec} applied to $\psi^2$ (of infinity type $4\ell$) gives
\begin{equation}\label{eq:casel=0}
L(\psi^2,s)=\frac{1}{w_K}\left (\frac{2}{\sqrt{|D|}}\right )^{s}\sum_{[\ida]=[\latbasis]}\psi^2(\ida)G_0(\omquot,s).
\end{equation}
Recall that we are interested in the value of $L(\psi^2,s)$ at $s=2\ell+1=1$. Since the non-holomorphic Eisenstein series of weight $0$ has a pole at $s=1$, we need to look at the next term in the Taylor expansion around $s=1$.

\begin{theorem}[Kronecker Limit Formula]
	Define the eta-function as
	\[\eta(z)=q^{1/24}\prod_{n=1}^\infty(1-q^n),\]
	where $q=e^{2\pi iz}$ and let
	\[G_0(z,s)=\Im(z)^s\sum_{m,n}|mz+n|^{-2s}\]
	be the non-holomorphic Eisenstein series of weight $0$. Then
	\[G_0(z,s)=\pi\left (\frac{1}{s-1}+C(z)+O(s-1)\right ),\]
	where
	\[C(z)=2\gamma-\log 4-2\log(\Im(z)^{1/2}|\eta(z)|^2)\]
	($\gamma=$Euler's constant).
\end{theorem}
\begin{proof}
	See \cite[Thm. 10.4.6]{Cohe}. Note that our definition of $G_0(z,s)$ differs from Cohen's by a factor of $1/2$.
\end{proof}

When $\psi^2$ is the trivial character, formula \ref{eq:casel=0} is nothing else but the well-known decomposition of the Dedekind zeta function of $K$ into a sum of Epstein zeta functions. Comparing the residues gives the class number formula for imaginary quadratic fields:
\[\Res_{s=1}\zeta_K(s)=L(\chi_D,1)=\frac{2\pi h_K}{w_K\sqrt{|D|}}\]
and comparing the constant terms gives the Chowla-Selberg formula.

When $\psi^2$ is not trivial, the function $L(\psi^2,s)$ is analytic at $s=1$\footnote{Note again the importance of the fact that the residue of the non-holomorphic Eisenstein series at $s=1$ does not depend on $z$.} and has value
\[L(\psi^2,1)=-\frac{4\pi}{w_K\sqrt{|D|}}\sum_{[\ida]\in\Clk}\psi^2(\ida)\log(\Im(\tau_\ida)^{1/2}|\eta(\tau_\ida)|^2).\]
Putting this in formula \ref{NormLpsi}, we get
\begin{equation}\label{eq:filall=0}
	\langle\tpsi,\tpsi\rangle =-V_D^{-1}\frac{4h_K}{w_K^2}\sum_{[\ida]\in\Clk}\psi^2(\ida)\log(\Im(\tau_\ida)^{1/2}|\eta(\tau_\ida)|^2).
\end{equation}

Note that factoring out the volume helps understanding the algebraic properties of the quantity on the right. This formula tells us that normalizing the Petersson inner product by dividing by the volume, as we did, artificially introduces transcendental numbers in the Petersson norm. We will come back to this point after we treat the case $\ell>0$.

\subsection{The case $\ell>0$: derivative of almost holomorphic Eisenstein series}\label{sec:caselgeq1}
Define as usual the following differential operators on real analytic functions on the upper half-plane
\[\frac{\del}{\del z}=\frac{1}{2}\left (\frac{\del}{\del x}-i\frac{\del }{\del y}\right ).\]

For any integer $k$ and congruence subgroup $\Gamma$, let $\hat{M}_k(\Gamma)$ be the space of \emph{almost holomorphic modular forms} of weight $k$ and level $\Gamma$. An element of this space is a $\dashk\gamma$-invariant function for all $\gamma\in\Gamma$, but instead of being holomorphic on $\H$, it is a polynomial in $1/\Im(z)$ with holomorphic coefficients satisfying some growth condition at infinity. The simplest example (and the only one we need) of almost holomorphic modular form is $E_2\in\hat{M}_2(\SL)$.

If $f\in \hat{M}_k(\Gamma)$ is an almost holomorphic modular form, the operator $\del_k$ defined as
\[\del_k f=\frac{1}{2\pi i}\frac{\del f}{\del z}-\frac{k}{4\pi\Im(z)}f\]
takes $f$ to an element of $\hat{M}_{k+2}(\Gamma)$. To simplify the notation, define
\[\del_k^n=\del_{k+2n-2}\circ\dots\circ\del_{k+2}\circ\del_k.\]

The following lemma is the starting point of our investigation.

\begin{lemma}
	Let $G_k(z,s)$ be the non-holomorphic Eisenstein series of weight $k$ defined in section \ref{sec:Eisen}. Then
	\[\del_k^nG_k(z,s)=(-4\pi)^{-n}\frac{\Gamma(k+s+n)}{\Gamma(s+k)}G_{k+2n}(z,s-n)\]
\end{lemma}
\begin{proof}
	This is \cite[Formula 9.12]{Shi1} with $N=1$ and $p=q=0$. Note also that our $\del_k$ is Shimura's $D_k$ (we follows Zagier's notation).
\end{proof}

This leads to the following

\begin{coro}\label{eq:Heckespecialvalues}
	Let $\psi$ be a Hecke character of infinity type $2\ell>2$ as above and let $m$ be an integer such that $\ell+1\leq m\leq 2\ell$. Then
	\[L(\psi,m)=\frac{1}{w_K}(-4\pi)^{2\ell-m}\frac{\Gamma(2m-2\ell)}{\Gamma(m)}\left (\frac{\sqrt{|D|}}{2}\right )^{2\ell-m}\sum_{[\ida]=[\latbasis]}\frac{\psi(\ida)}{\omega_2^{2\ell}}\del^{2\ell-m}G_{2m-2\ell}(\omquot,0),\]
	where as usual the sum runs over positively oriented basis of representatives of the ideal class group of $K$.
\end{coro}
\begin{proof}
	Using the Lemma above with $n=2\ell-m\geq 0$ and $k=2m-2\ell\geq 2$, we see that
	\[G_{2\ell}(z,s+m-2\ell)=(-4\pi)^{2\ell-m}\frac{\Gamma(s+2m-2\ell)}{\Gamma(s+m)}\del^{2\ell-m}G_{2m-2\ell}(z,s).\]
	Putting this in the formula of Corollary \ref{eq:Eisensteindec} (evaluated at $s+m$), we see that
	\[L(\psi,s+m)=\frac{1}{w_K}(-4\pi)^{2\ell-m}\frac{\Gamma(s+2m-2\ell)}{\Gamma(s+m)}\left (\frac{\sqrt{|D|}}{2}\right )^{-(s+m-2\ell)}\sum_{[\ida]=[\latbasis]}\frac{\psi(\ida)}{\omega_2^{2\ell}}\del^{2\ell-m}G_{2m-2\ell}(z,s),\]
\end{proof}

Using the fact that
\[2^{-1}(2\pi i)^{-k}\Gamma(k)G_k(z,0)=E_k(z),\]
for all $k\geq 2$, where
\begin{equation}\label{def:E2}
E_2(z)=\frac{1}{8\pi\Im(z)}-\frac{1}{24}+\sum_{n=1}^\infty\sigma_1(n)q^n
\end{equation}
and
\begin{equation}\label{def:Ek}
E_k=-\frac{B_k}{2k}+\sum_{n=1}^\infty\sigma_{k-1}(n)q^n
\end{equation}
is the usual holomorphic Eisenstein series for $k\geq 4$ (see \cite[Sec 9.2]{Shi1}), one sees that the previous Corollary relates certain special values of the Hecke $L$-function attached to $\psi$ to the derivatives of the usual Eisenstein series. Indeed, the formula becomes
\begin{equation}\label{eq:Heckespecialvalues2}
	L(\psi,m) = (-1)^\ell\sqrt{|D|}^{2\ell-m}\frac{(2\pi)^m}{\Gamma(m)}\sum_{[\ida]\in\Clk}\psi(\ida)\del^{2\ell-m}E_{2m-2\ell}(\ida).
\end{equation}

Applying this formula to $\psi^2$ with $m=2\ell+1$, we get
\[L(\psi^2,2\ell+1)=\sqrt{|D|}^{2\ell-1}\frac{(2\pi)^{2\ell+1}}{\Gamma(2\ell+1)}\sum_{[\ida]=[\latbasis]}\frac{\psi^2(\ida)}{\omega_2^{4\ell}}\del^{2\ell-1}E_{2}(\omquot).\]

Using this value of $L(\psi^2,2\ell+1)$ in formula \ref{NormLpsi} and simplifying finally gives
\begin{equation}\label{eq:finallgeq1}\langle\tpsi,\tpsi\rangle = V_D^{-1}(|D|/4)^\ell\frac{4h_K}{w_K^2}\sum_{[\ida]=[\latbasis]}\frac{\psi^2(\ida)}{\omega_2^{4\ell}}\del^{2\ell-1}E_{2}(\omquot).
\end{equation}

Note that this can also be written in homogeneous form as
\[\langle\tpsi,\tpsi\rangle=V_D^{-1}(|D|/4)^\ell\frac{4h_K}{w_K^2}\sum_{[\ida]\in\Clk}\psi^2(\ida)\del^{2\ell-1}E_{2}(\ida).\]

\begin{coro}\label{coro:algebraicitytpsi}
	For $\ell>0$,
	\[V_D\langle\tpsi,\tpsi\rangle=\alpha\Omega_K^{4\ell},\]
	where $\alpha$ is an algebraic number and $\Omega_K$ is the Chowla-Selberg period attached to $K$ and depends only on $K$.
\end{coro}
\begin{proof}
	From the Corollary of Proposition 27 in \cite{Zag}, it follows that
	\[\del_2^{2\ell-1}E_2(\tau)\]
	is an algebraic multiple of $\Omega_K^{2+2(2\ell-1)}=\Omega_K^{4\ell}$, whenever $\tau\in K\cap\H$ is a CM point. The Corollary follows from the fact that the values of the Hecke characters $\psi_\ell$ and all the other quantities in formula \ref{eq:finallgeq1} are algebraic.
\end{proof}

\subsection{The case $\ell=0$ revisited}
Strictly speaking, formula \ref{eq:finallgeq1} does not make sense for $\ell=0$. However, it is natural to define $\del_2^{-1}$ as a weight $0$ "modular form" $f$ such that
\[\del_0 f(z)=E_2(z).\]
We claim that
\[\del_0 \log(\Im(z)^{1/2}|\eta(z)|^2)=-E_2(z),\]
where
\[\del_0=\frac{1}{2\pi i}\frac{\del}{\del z}.\]
This follows from the well known fact (see \cite[Prop. 7]{Zag}) that
\[\frac{1}{2\pi i}\frac{\del}{\del z}\log\Delta(z)=1-24\sum_{n=1}^\infty\sigma_1(n)q^n\]
and the identity
\[\Delta(z)=\eta(z)^{24}.\]
Indeed, since
\[\log|\Delta(z)|=\Re(\log\Delta(z)),\]
this implies
\[\frac{\del}{\del z}\log|\Delta(z)|=\frac{1}{2}\frac{\del}{\del z}\log\Delta(z)\]
(recall that $\frac{\del\bar{f}}{\del z}=\overline{\frac{\del f}{\del \bar{z}}}=0$ if $f(z)$ is holomorphic).

The equality
\[\del_0 \log(\Im(z)^{1/2}|\eta(z)|^2)=-E_2(z)\]
implies that formula \ref{eq:finallgeq1} also makes sense for $\ell=0$ and gives back exactly formula \ref{eq:filall=0}. Note also that $\log(\Im(z)^{1/2}|\eta(z)|^2)$ is $\SL$-invariant, as desired. However, I don't think $\log(\Im(z)^{1/2}|\eta(z)|^2)$ is almost holomorphic.

\section{Theta functions attached to ideals in imaginary quadratic fields}
In this section we define theta series attached to ideals in imaginary quadratic fields and certain spherical polynomials and see how these theta functions are relate to the theta functions $\tpsi$.

Throughout this section, fix an integer $\ell\geq 0$.

Let $\ida$ be a fractional ideal of $K$ and define the theta function attached to $\ida$ (and $\ell$) as
\[\theta_\ida^{(2\ell)}=\tida(z)=\sum_{\lambda\in\ida}\lambda^{2\ell}q^{N(\lambda)/N(\ida)},\]
where we define $0^0=1$ in case $\ell=0$. Then we have the following
\begin{prop}
	The function $\tida$ is a modular form of weight $2\ell+1$, level $\Gamma_0(|D|)$ and Nebentypus $\chi_D$. Moreover, it is a cusp form if $\ell>0$.
\end{prop}
\begin{proof}
	This is well-know, but tedious to prove! A good reference for that is \cite[Thm. 10.9]{Iwan}. The point is that the function $\lambda\mapsto\lambda^{2\ell}$ is a spherical polynomial for the binary quadratic form $N(\lambda)/N(\ida)$. 
\end{proof}

If $\psi$ is a Hecke character of infinity type $2\ell$, the theta function $\tpsi$ decomposes as follows:
\begin{equation}\label{eq:tpsidec}
\tpsi=\frac{1}{w_K}\sum_{[\ida]\in\Clk}\psi(\ida)^{-1}\tida,
\end{equation}
where the sum runs over representatives of the class group. Note that $\tida$ depends on the choice of $\ida$ in $[\ida]$, since
\[\theta_{\mu\mathfrak{a}}=\mu^{2\ell}\tida\]
for any $\mu\in K^\times$, but the sum is still independent of this choice. To prove formula \ref{eq:tpsidec}, one uses the same trick as in the proof of Proposition \ref{eq:partialdec}.

Note that the $L$-function attached to $\theta_\ida^{(2\ell)}$ is the partial Hecke $L$-function $L^{(2\ell)}(\overline{\ida},s)$ introduced before.

Our next goal is to write $\tida$ in terms of the $\tpsi$. For this, the following Lemma is useful.

\begin{lemma}\label{orthorel}
	Fix an integer $\ell\geq 0$ and let $\idc$ be a fractional ideal of $K$. Then
	\[\sum_{\psi}\psi(\idc)=\begin{cases}
	0	&\text{if } [\idc]\neq[\O_K]\\
	\lambda^{2\ell}h_K &\text{if } \idc=\lambda\O_K\\
\end{cases},\]
where the sum runs over all Hecke characters of $K$ of infinity type $2\ell$.
\end{lemma}
\begin{proof}
	Fix a Hecke character $\chi$ of infinity type $2\ell$. Then
	\[\sum_{\psi}\psi\chi^{-1}(\idc)=\begin{cases}
	0	&\text{if } [\idc]\neq[\O_K]\\
	h_k &\text{if } \idc=\lambda\O_K\\
\end{cases},\]
	by the orthogonality relations of finite abelian group characters, since $\psi\chi^{-1}$ is a character of $\Clk$. The claim follows by multiplying both sides by $\chi(\idc)$ since $\chi(\lambda\O_K)=\lambda^{2\ell}$.
\end{proof}

This leads to the following
\begin{prop}\label{thetaadecomp}
	With $\tida$ defined as above,
	\[\tida=\frac{w_K}{h_K}\sum_{\psi}\psi(\ida)\tpsi,\]
	where the sum runs over all Hecke characters of infinity type $2\ell$.
\end{prop}
\begin{proof}
	This follows formally from the previous Lemma and the expression for $\tpsi$ in terms of the $\theta_\ida$.
\end{proof}

Using the orthogonality of the $\tpsi$ under the Petersson inner product when $\ell>0$, one can compute $\langle\tida,\theta_\idb\rangle$ in terms of the Petersson norm of the $\tpsi$. When $\ell=0$, the $\tpsi$ are not always cusp forms and we have not found a way to compute (or even define) the Petersson norm of all the $\tpsi$. However, we still have the following

\begin{prop}\label{formula:innerprod}
	Let $\ell>0$ and let $\theta_\ida$ and $\theta_\idb$ be defined as above. Then
	\[\langle\theta_\ida,\theta_\idb\rangle=C_K N(\idb)^{2\ell}\sum_{\ida\idb^{-1}\idc^2=\lambda_\idc\O_K}\lambda_\idc^{2\ell}\del^{2\ell-1}E_2(\idc),\]
	where the sum runs over all ideal classes $[\idc]\in\Clk$ such that $\idc^2\ida\idb^{-1}=\lambda_\idc\O_K$ for some $\lambda_\idc\in K$ and
	 \[C_K=4V_D^{-1}(|D|/4)^\ell.\]
	 In particular, $\theta_\ida$ and $\theta_\idb$ are orthogonal if $\ida$ and $\idb$ are not in the same genus.
\end{prop}
\begin{proof}
	First, we compute
	\begin{align*}
		\langle\theta_\ida,\theta_\idb\rangle &= \frac{w_K^2}{h_K^2}\sum_{\psi,\chi}\psi(\ida)\overline{\chi}(\idb)\langle\theta_\psi,\theta_\chi\rangle\\
		&= \frac{w_K^2}{h_K^2}\sum_{\psi}\psi(\ida)\overline{\psi}(\idb)\langle\theta_\psi,\theta_\psi\rangle\\
		&= \frac{w_K^2}{h_K^2}\sum_{\psi}\psi(\ida)N(\idb)^{2\ell}\psi^{-1}(\idb)\langle\theta_\psi,\theta_\psi\rangle\\
		&= \frac{C_K}{h_K}N(\idb)^{2\ell}\sum_{\psi,[\idc]}\psi(\ida\idb^{-1}\idc^2)\del^{2\ell-1}E_2(\idc),
	\end{align*}
	where the first sum is a double sum over all Hecke characters of infinity type $2\ell$ and we used the orthogonality of the newforms $\tpsi$ in the second equality.
	
	Summing the last sum over $\psi$ first and using Lemma \ref{orthorel}, we see that
	\[\langle\theta_\ida,\theta_\idb\rangle=0\]
	if for all $[\idc]\in\Clk$, $\ida\idb^{-1}\idc^2$ is not principal, i.e. $\ida$ and $\idb$ are not in the same genus. Otherwise, if $\ida\idb^{-1}\idc^2=\lambda_\idc\O_K$ for some $\lambda_\idc\in K$, then
	\[\sum_{\psi}\psi(\ida\idb^{-1}\idc^2)=\lambda_\idc^{2\ell} h_K\]
	and the last line of the above computation becomes
	\[\langle\theta_\ida,\theta_\idb\rangle=C_K N(\idb)^{2\ell}\sum_{\ida\idb^{-1}\idc^2=\lambda_\idc}\lambda_\idc^{2\ell}\del^{2\ell-1}E_2(\idc).\]
\end{proof}

The folowing corollary can be seen as a way to "factor" inner products of theta series.

\begin{coro}\label{coro:factorpip}
	Fix $\ell>0$. Then
	\[\langle\theta_{\ida\idc},\theta_{\idc\idb}\rangle=N(\idb\idc)^{2\ell}\langle\theta_{\ida},\theta_{\idb}\rangle.\]
\end{coro}

A consequence of this corollary is that the Petersson norm of the theta series attached to a quadratic ideal of $K$ depends only on its norm and the parameter $\ell$.

\begin{coro}\label{coro:algebraicitypip}
	Fix $\ell>0$. Then
	\[V_D\langle\tida,\theta_\idb\rangle=\alpha\Omega_K^{4\ell},\]
	where $\alpha$ is some algebraic number and $\Omega_K$ is the Chowla-Selberg period attached to $K$.
\end{coro}

\section{An efficient algorithm to compute the Petersson inner product of binary theta series}
Formula \ref{formula:innerprod} can be used to numerically evaluate the Petersson inner product of theta series attached to imaginary quadratic fields in an efficient way ($1000$ decimals in a few seconds!). To implement this formula, one should be able to find the derivatives of $E_2$, to evaluate them at lattices and find, for fixed ideals $\ida$ and $\idb$, all ideal classes $\idc$ such that $\ida\idb^{-1}\idc^2=\lambda_\idc\O_K$. We talk about those problems in the next section and then we give a pseudo-algorithm to solve our initial problem of computing $\langle\tida,\theta_\idb\rangle$.\footnote{A PARI/GP implementation of this algorithm is available on {https://github.com/NicolasSimard/ENT}.}

\subsection{Towards the algorithm}
\subsubsection{Derivatives of almost holomorphic modular forms}
First, recall that the ring of almost holomorphic of level $1$ is isomorphic as a $\C$-algebra to
\[\C[E_2,E_4,E_6].\]
It follows that in order to compute $\del^nE_2$, it suffices to know $\del E_2,\del E_4$ and $\del E_6$. For this, we have the following

\begin{prop}
	Let $E_2,E_4$ and $E_6$ be the almost holomorphic modular forms defined by equation \ref{def:E2} and \ref{def:Ek} and let
	\[\del_k=\frac{1}{2\pi i}\frac{\del}{\del z}-\frac{k}{4\pi\Im(z)}\].
	Then
	\[\del E_2=\frac{5}{6}E_4-2E_2^2,\hspace{1cm}\del E_4=\frac{7}{10}E_6-8E_2E_4,\hspace{1cm}\del E_6=\frac{400}{7}E_4^2-12E_2E_6.\]
\end{prop}
\begin{proof}
	This is in \cite[Sec 9.2]{Shi1}, plus the fact that
	\[120E_4^2=E_8.\]
\end{proof}

\emph{Add recursive formula to express $E_K$ as a polynomial in $E_4$ and $E_6$.}

\subsubsection{Evaluating Eisenstein series at CM points}
By the above, the problem reduces to evaluating $E_2,E_4$ and $E_6$ at lattices. Generally, the Fourier expansions of these Eisenstein series converge very quickly. However, we have some freedom in choosing the lattice at which we evaluate them. As the following example shows, one should really take advantage of that.

Take $K=\Q(\sqrt{-26})$. Then $D=-104$, and $\Clk$ is cyclic of order $6$, generated by any prime above $5$. In fact, since
\[N(109-12\sqrt{-26})=5^6,\]
\[\p_5^6=\lambda\O_K,\]
where $\lambda=109+12\sqrt{-26}$ and $\p_5$ is one of the two primes above $5$ (chosen so that the equation holds). Using PARI/GP, we find $\Z$-basis for $\p_5^4$  and $\p_5^{-2}$:
\[\p_5^4=[625,43+\sqrt{-26}],\hspace{1cm}\p_5^{-2}=[1,(7+\sqrt{-26})/25].\]
From the equality $\p_5^4=\lambda\p_5^{-2}$, we deduce that
\[\del^{n}E_2(\p_5^4)=\lambda^{-(2+2n)}\del^{n}E_2(\p_5^{-2})\]
and using the above $\Z$-basis, we have
\[625^{-(2+2n)}\del^nE_2((43+\sqrt{-26})/625)=\lambda^{-(2+2n)}\del^n E_2((7+\sqrt{-26})/25).\]
For $n=1$ and working with $500$ digits of precision, the left-hand side of the equation takes about $30$ times more time to evaluate than the right-hand side (which takes around 1sec to evaluate on my desktop computer)! This proves that the running time of the algorithm depends in a crucial way on the choice of class representatives in a given ideal class.

The reason for the large difference in computation time in the above example is of course that the imaginary part of $(43+\sqrt{-26})/625$ is smaller than the imaginary part of $(7+\sqrt{-26})/25$. Using the correspondence between ideal classes and equivalence classes of positive definite integral binary quadratic forms, we see that the ideal corresponding to the quadratic form $[a,b,c]$ has $\Z$-basis
\[[a,(-b+\sqrt{D})/2]\]
and the imaginary part of the corresponding point in the upper-half plane is
\[\frac{\sqrt{|D|}}{2a}.\]
For fixed $D$, our problem is then to minimize $a$. It turns out that in a given class, the quadratic form with minimal $a$ is the unique reduced quadratic form in that class. Moreover, for any reduced form, one has the following upper bound for $a$
\[a\leq \sqrt{|D|}/3,\]
which leads to a lower bound on the imaginary part of to corresponding point in the upper-half plane. This proves the following

\begin{prop}
	Let $K$ be an imaginary quadratic field and let $\mathcal{C}$ be an ideal class in $\Clk$. Then there exists an explicit positively oriented ideal $\latbasis$ such that
	\[\frac{3}{2}\leq\Im(\omquot).\]
\end{prop}

This discussion leads to the following simple algorithm to evaluate $\del^nE_2$ at an ideal in an imaginary quadratic field: find the class to which this ideal belongs and use the CM point corresponding to the reduced form in that class to evaluate $\del^nE_2$. The lower bound above is a kind of guarantee on the speed of this algorithm.

\subsubsection{Ambiguous classes}
The last problem in computing $\langle\tida,\theta_\idb\rangle$ is to find all ideal classes $\idc$ such that $\ida\idb^{-1}\idc^2=\lambda_\idc\O_K$ (and find $\lambda_\idc$ too). Given a set of generators for $\Clk$, it is easy to determine if the class $\ida\idb^{-1}$ is a square in $\Clk$ and to find a class $\idc_0$ such that
\[\ida\idb^{-1}\idc_0^2=\lambda\O_K.\]
Indeed, write $\ida\idb^{-1}$ in term of those generators and check that only even powers of the generators occur. The following proposition completes the task.

\begin{prop}
	Let $\ida\idb^{-1}\idc_0^2=\lambda\O_K$ for some ideal $\idc_0$. Let
	\[\{\ida_1,\dots,\ida_g\}\]
	be representatives of $\Clk[2]$ and define $\alpha_i$ for $1\leq i\leq g$ as
	\[\ida_i^2=\alpha_i\O_K.\]
	Then
	\[\sum_{\ida\idb^{-1}\idc^2=\lambda_\idc\O_K}\lambda_\idc^{2\ell}\del^{2\ell-1}E_2(\idc)=\lambda^{2\ell}\sum_{i=1}^g\alpha_i^{2\ell}\del^{2\ell-1}E_2(\idc_0\ida_i).\]
\end{prop}
\begin{proof}
	It suffices to note that any ideal $\idc$ such that
	\[\ida\idb^{-1}\idc^2=\lambda_\idc\O_K\]
	is equivalent to $\idc_0\ida_i$ for some $i$ and that 
	\[\ida\idb^{-1}(\idc_0\ida_i)^2=\lambda\alpha_i\O_K.\]
\end{proof}

The $2$-torsion classes in $\Clk$ are also known as the ambiguous classes of $K$. They are easy to compute using the theory of binary quadratic forms\footnote{Indeed, the inverse of the positive definite binary quadratic form $[a,b,c]$ is $[a,-b,c]$ and forcing these forms to be equivalent puts big restrictions on $a,b$ and $c$.} and there are exactly $g$ of them, where $g$ is the number of genera in $K$ (i.e. $g=|\Clk/\Clk^2|$).

\subsection{A pseudo algorithm}
At this point, the problem is purely computational. Our goal is to compute
$\langle\tida,\theta_\idb\rangle$,
for fixed quadratic field $K$ of discriminant $D$ and varying $\ida,\idb$ and $\ell$. To do so, first define an initializing function which takes a fundamental discriminant $D$ as input and returns a list $L(D)$ of length $4$ of the form
\[L(D)=[K,\mathcal{R},\mathcal{A},M],\]
where
\begin{itemize}
	\item $K$ is the quadratic field of discriminant $D$;
	\item $\mathcal{R}$ is a list of representatives of $\Clk$ corresponding to reduced quadratic forms;
	\item $\mathcal{A}$ is a list of representatives of $\Clk[2]$ (the $\ida_i$s) together with the $\alpha_i$s such that $\ida_i=\alpha_i\O_K$.
	\item $M$ is a $3\times h_K$ matrix where $M[k,d]=E_{2k}(f_d)$ for $1\leq k\leq 3$ and $f_d\in\mathcal{R}$.
\end{itemize}

The most time consuming part when computing this vector is of course to compute $M$, but this is done as efficiently as possible by our choice of representatives of $\Clk$.

Now given $L(D)$, it is a simple exercise to compute
\[\langle\tida,\theta_\idb\rangle.\]
A systematic way of doing this is to follow these steps:

\begin{enumerate}
	\item Determine if $\ida\idb^{-1}$ is a square. If it is not, return $0$. Otherwise, find  $\idc_0$ and $\lambda$ such that
	\[\ida\idb^{-1}\idc_0^2=\lambda\O_K.\]
	\item Express $\del^{2\ell-1}E_2$ as a polynomial on $E_2,E_4$ and $E_6$.
	\item Compute $\del^{2\ell-1}E_2(\idc_0\ida_i)$ for all $\ida_i\in\mathcal{A}$(using $M$).
	\item Compute
	\[\langle\tida,\theta_\idb\rangle=C_K N(\idb)^{2\ell}\lambda^{2\ell}\sum_{i=1}^g\alpha_i^{2\ell}\del^{2\ell-1}E_2(\idc_0\ida_i).\]
\end{enumerate}

Each step is very quick, given the previously computed data $L(D)$. Note that to evaluate $\del^{2\ell-1}E_2(\idc_0\ida_i)$ in step $3.$, one must find $f_d\in\mathcal{R}$ and $\mu\in K^\times$ such that
\[\idc_0\ida_i=\mu f_d\]
and so
\[\del^{2\ell-1}E_2(\idc_0\ida_i)=\mu^{-4\ell}\del^{2\ell-1}E_2(f_d),\]
which is easy to compute using $M$ and step $2.$.


\section{Numerical examples}
In this section, we give numerical examples of computations using the above formulas when $\ell>0$. Our goal is to compute the determinant of the matrix
\[M_\mathcal{R}(\ell)=(V_D\langle\theta_{\ida_i}^{(2\ell)},\theta_{\ida_j}^{(2\ell)}\rangle)_{1\leq i,j\leq h_K},\]
where $\mathcal{R}=\{\ida_1,\dots,\ida_h\}$ is a set of representatives of the class group of $K$. Of course, $M_\mathcal{R}(\ell)$ depends on $\mathcal{R}$. In fact, if $\mathcal{R}'$ is the set of representatives obtained from $\mathcal{R}$ by changing one of the $\ida_i$ by $\mu\ida_i$ for some $\mu\in K^\times$, one sees immediately that
\[\det M_{\mathcal{R}'}(\ell)=N(\mu)^{2\ell}\det M_\mathcal{R}(\ell).\]
Note that by Proposition \ref{formula:innerprod}, $M_\mathcal{R}(\ell)$ is a block diagonal matrix (after reordering the ideals of $\mathcal{R}$, if necessary).

When $\ell>0$, the determinant of $M_\mathcal{R}$ is explicitly related to the determinant of the diagonal matrix
\[M_K(\ell)=\begin{pmatrix}
V_D\langle\theta_{\psi_1}, \theta_{\psi_1}\rangle&  &  &  \\ 
 & V_D\langle\theta_{\psi_2}, \theta_{\psi_2}\rangle &  &  \\ 
 &  & \ddots &  \\ 
 &  &  & V_D\langle\theta_{\psi_h}, \theta_{\psi_h}\rangle
\end{pmatrix},
\]
where the $\psi_i$ are the Hecke characters of $K$ of infinity type $2\ell$. Note that $M_K(\ell)$ is canonically attached to $K$ and $\ell$ and that its determinant is a product of special values of Hecke $L$-functions by Formula \ref{NormLpsi}.

Both matrices have transcendental entries. However, it is possible to explicitly normalize the entries to make them algebraic, as was proved in Corollaries \ref{coro:algebraicitytpsi} and \ref{coro:algebraicitypip}. In the computations that follow, we normalize using the Chowla-Selberg attached to $K$, defined here as
\[\Omega_K = \frac{1}{\sqrt{4\pi|D|}}\left (\prod_{j=1}^{|D|-1}\Gamma(j/|D|)^{\chi_D(j)}\right )^{w_K/(4h_K)}.\]



\subsection{Class number $1$}
If $K$ has class number $1$, there is only one theta series and
\[\theta_{\O_K}=\theta_{\psi_0},\]
where $\psi_0$ is the only Hecke character of infinity type $2\ell$. In the following table, we find numerically the algebraic number
\[V_D\langle\theta_{\O_K},\theta_{\O_K}\rangle/\Omega_K^{4\ell},\]
for all imaginary quadratic fields of class number one and for $1\leq \ell\leq 4$.

\renewcommand{\arraystretch}{1.5}
\begin{tabular}{cc|*{2}{l|}*{2}{p{3.5cm}|}}
\cline{3-6}
& & \multicolumn{4}{ c| }{$\ell$} \\ \cline{3-6}
& & 1 & 2 & 3 & 4 \\ \cline{1-6}
\multicolumn{1}{ |c| }{\multirow{7}{*}{$D$}} & \multicolumn{1}{ |c| }{-7}
&$2^{2}3$&$-2^{2}$&$-2^{2}17$&$-2^{2}7\cdot191$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}&\multicolumn{1}{ |c| }{-8}
&$-2$&$-2^{2}5$&$-2^{4}23$&$-2^{5}181$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}&\multicolumn{1}{ |c| }{-11}
&$-2^{2}$&$-2^{3}5$&$-2^{2}139$&$-2^{9}5^{3}$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}&\multicolumn{1}{ |c| }{-19}
&$-2^{2}3^{-1}13$&$-2^{3}71$&$-2^{2}11\cdot29^{2}$&$-2^{8}14753$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}&\multicolumn{1}{ |c| }{-43}
&$-2^{3}3^{-1}107$&$-2^{4}5647$&$-2^{2}16876283$&$-2^{8}23\cdot15431881$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}&\multicolumn{1}{ |c| }{-67}
&$-2^{2}3^{-1}7^{2}31$&$-2^{3}5\cdot86629$&$-2^{2}3547447667$&$-2^{10}281\cdot3529\cdot105607$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}&\multicolumn{1}{ |c| }{-163}
&$-2^{3}3^{-1}150473$&$-2^{4}11\cdot461681471$&$-2^{2}127\cdot659\cdot119633471311$&$-2^{8}13^{2}53\cdot383\cdot2729\cdot15275296963$\\
\cline{1-6}
\end{tabular}

Note that the entries are rational integers (and even integers most of the time).

\subsection{Class number $2$}
If $K$ has class number $2$, there are $2$ genera and each of them contains a single class. If $\ida$ is a representative of the non-trivial ideal class of $K$, one sees using formula \ref{formula:innerprod} that 
\[\langle\theta_\ida,\theta_{\O_K}\rangle = \langle\theta_{\O_K},\theta_\ida\rangle=0\]
and
\[\langle\theta_\ida,\theta_\ida\rangle=N(\ida)^{2\ell}\langle\theta_{\O_K},\theta_{\O_K}\rangle,\]
so
\[\det M_{\{\O_K,\ida\}}(\ell)=N(\ida)^{2\ell}\langle\theta_{\O_K},\theta_{\O_K}\rangle^2.\]
Therefore, it suffices to analyse the numbers $\langle\theta_{\O_K},\theta_{\O_K}\rangle$. In the following table, we find numerically the algebraic number
\[V_D\langle\theta_{\O_K},\theta_{\O_K}\rangle/\Omega_K^{4\ell},\]
for all imaginary quadratic fields of class number two and for $1\leq \ell\leq 4$.

\begin{tabular}{cc|*{3}{p{3cm}|}p{3.5cm}|}
\cline{3-6}
& & \multicolumn{4}{ c| }{$\ell$} \\ \cline{3-6}
& & 1 & 2 & 3 & 4\\ \cline{1-6}
\multicolumn{1}{|c|}{\multirow{18}{*}{$D$}}& \multicolumn{1}{|c|}{$-15$}
& $-2^{2}$ & $-2^{2}3\cdot13$ & $-2^{2}3\cdot5\cdot53$ & $-2^{2}3^{2}5\cdot11\cdot73$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-20$}
& $-2^{4}$ & $-2^{3}37$ & $-2^{7}5\cdot43$ & $-2^{6}5\cdot10657$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-24$}
& $-2^{2}7$ & $-2^{3}3\cdot47$ & $-2^{5}3\cdot23\cdot37$ & $-2^{6}3^{2}7\cdot3163$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-35$}
& $-2^{2}3^{2}$ & $-2^{3}3\cdot199$ & $-2^{3}3\cdot5\cdot3301$ & $-2^{8}3^{4}5\cdot7\cdot229$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-40$}
& $-2^{2}29$ & $-2^{3}37\cdot41$ & $-2^{5}3^{2}5\cdot2143$ & $-2^{6}5\cdot11\cdot304867$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-51$}
& $-2^{2}43$ & $-2^{3}3\cdot5\cdot181$ & $-2^{3}3\cdot386489$ & $-2^{8}3^{2}5\cdot11\cdot29\cdot1979$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-52$}
& $-2^{4}17$ & $-2^{3}6421$ & $-2^{7}3\cdot53597$ & $-2^{6}1613\cdot181913$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-88$}
& $-2^{2}7\cdot73$ & $-2^{3}23\cdot31\cdot373$ & $-2^{5}3^{3}47\cdot109\cdot1217$ & $-2^{6}5003\cdot82114223$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-91$}
& $-2^{7}3^{-1}19$ & $-2^{5}139\cdot157$ & $-2^{3}71\cdot79\cdot24859$ & $-2^{8}7\cdot23\cdot57233807$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-115$}
& $-2^{2}3\cdot197$ & $-2^{3}31\cdot11657$ & $-2^{3}3^{2}5\cdot17\cdot31\cdot65449$ & $-2^{9}5\cdot29744878249$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-123$}
& $-2^{4}5\cdot59$ & $-2^{6}3\cdot7\cdot29\cdot269$ & $-2^{3}3\cdot7\cdot19\cdot31\cdot599\cdot877$ & $-2^{8}3^{2}5\cdot23\cdot2018719939$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-148$}
& $-2^{4}11\cdot139$ & $-2^{3}101\cdot421\cdot653$ & $-2^{7}3\cdot12612115157$ & $-2^{6}16658933\cdot180376241$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-187$}
& $-2^{2}7\cdot547$ & $-2^{3}20086217$ & $-2^{3}3^{3}23\cdot533745103$ & $-2^{11}7\cdot59\cdot119478576781$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-232$}
& $-2^{2}3^{2}9677$ & $-2^{3}2447\cdot1773907$ & $-2^{5}3^{3}9718885998641$ & $-2^{6}43\cdot1368715394403766639$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-235$}
& $-2^{2}16619$ & $-2^{3}29\cdot6766423$ & $-2^{3}3^{2}5\cdot200329\cdot1210103$ & $-2^{9}5\cdot3617\cdot1212552488207$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-267$}
& $-2^{2}17\cdot53\cdot79$ & $-2^{3}3\cdot17\cdot29\cdot2069213$ & $-2^{3}3\cdot79231\cdot2668717679$ & $-2^{8}3^{2}199\cdot4141371112096921$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-403$}
& $-2^{2}3^{-1}431\cdot1789$ & $-2^{3}137\cdot322181789$ & $-2^{3}33547\cdot1222350596561$ & $-2^{8}783588203\cdot1859251547159$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-427$}
& $-2^{2}3^{-1}5\cdot19\cdot23\cdot647$ & $-2^{3}2437\cdot48695077$ & $-2^{3}51449\cdot913573\cdot3081919$ & $-2^{8}5\cdot7\cdot272407\cdot1278942841515113$\\
\cline{1-6}
\end{tabular}

Note again that these quantities are rational integers (and integers most of the time).

For the $\theta_\psi$, we see that
\[\langle\theta_{\psi_1}, \theta_{\psi_1}\rangle=\langle\theta_{\psi_2}, \theta_{\psi_2}\rangle,\]
where $\psi_1$ and $\psi_2$ are the two Hecke characters of $K$ of infinity type $2\ell$, since $\psi_1^2=\psi_2^2$. It also turns out that $\langle\theta_{\psi_1}, \theta_{\psi_1}\rangle$ and $\langle\theta_{\O_K},\theta_{\O_K}\rangle$ are essentially equal (up to powers of $2$).

\subsection{Idoneal numbers}

\begin{tabular}{cc|*{3}{p{3cm}|p{3.5cm}|}}
\cline{3-6}
& & \multicolumn{4}{ c| }{$\ell$} \\ \cline{3-6}
& & 1 & 2 & 3 & 4\\ \cline{1-6}
\multicolumn{1}{|c|}{\multirow{20}{*}{$D$}}& \multicolumn{1}{|c|}{$-84$}
& $-2^{9}$ & $-2^{4}3\cdot2897$ & $-2^{13}3\cdot3877$ & $-2^{7}3^{2}7\cdot7282459$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-120$}
& $-2^{3}233$ & $-2^{4}3\cdot103\cdot257$ & $-2^{6}3\cdot5\cdot7\cdot359\cdot769$ & $-2^{7}3^{2}5\cdot31\cdot30659543$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-132$}
& $-2^{4}151$ & $-2^{4}3\cdot13^{2}233$ & $-2^{7}3\cdot11941247$ & $-2^{7}3^{2}12365291437$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-168$}
& $-2^{3}13\cdot61$ & $-2^{4}3\cdot227\cdot1093$ & $-2^{6}3\cdot113\cdot2216989$ & $-2^{7}3^{2}7\cdot51546898267$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-228$}
& $-2^{4}5\cdot283$ & $-2^{4}3\cdot163\cdot14699$ & $-2^{7}3\cdot773\cdot5097683$ & $-2^{7}3^{2}5\cdot3389\cdot2048278621$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-280$}
& $-2^{3}23\cdot211$ & $-2^{4}11\cdot2047063$ & $-2^{6}3^{2}5\cdot11\cdot9011\cdot26759$ & $-2^{7}5\cdot7\cdot112583\cdot569016817$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-312$}
& $-2^{3}31\cdot421$ & $-2^{4}3\cdot11\cdot71\cdot57251$ & $-2^{6}3\cdot554176930991$ & $-2^{7}3^{2}41\cdot1433519\cdot133798411$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-340$}
& $-2^{5}29\cdot97$ & $-2^{4}105209333$ & $-2^{8}3^{3}5\cdot7\cdot377853659$ & $-2^{7}5\cdot23\cdot59\cdot7948500647621$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-372$}
& $-2^{6}13\cdot17\cdot19$ & $-2^{4}3\cdot5\cdot17\cdot463\cdot6563$ & $-2^{9}3\cdot43\cdot8783\cdot2336771$ & $-2^{7}3^{2}19\cdot59\cdot103\cdot887\cdot2671\cdot962131$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-408$}
& $-2^{3}7\cdot31\cdot263$ & $-2^{4}3\cdot722719007$ & $-2^{6}3\cdot398557\cdot84903367$ & $-2^{7}3^{2}43\cdot83\cdot514247587049069$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-420$}
& $-2^{8}151$ & $-2^{5}3\cdot47\cdot49417$ & $-2^{11}3\cdot5\cdot19\cdot409\cdot14221$ & $-2^{8}3^{2}5\cdot7\cdot43\cdot21735127133$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-520$}
& $-2^{3}7\cdot16519$ & $-2^{4}107\cdot83439599$ & $-2^{6}3\cdot5\cdot151\cdot3517\cdot99178571$ & $-2^{7}5\cdot241\cdot31815617\cdot7280136961$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-532$}
& $-2^{9}5\cdot313$ & $-2^{4}83\cdot84815009$ & $-2^{13}3\cdot43\cdot40813878811$ & $-2^{7}5\cdot7\cdot521\cdot9580507980739999$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-660$}
& $-2^{6}4019$ & $-2^{5}3\cdot84955769$ & $-2^{9}3\cdot5\cdot769\cdot3079\cdot29129$ & $-2^{8}3^{2}5\cdot23^{2}12826651596377$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-708$}
& $-2^{4}211\cdot5233$ & $-2^{4}3\cdot14083\cdot55570667$ & $-2^{7}3\cdot38281\cdot13122545866403$ & $-2^{7}3^{2}631\cdot112237\cdot22318536285190567$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-760$}
& $-2^{3}3^{2}148331$ & $-2^{4}7\cdot137\cdot986380123$ & $-2^{6}3^{2}5\cdot17958574802156873$ & $-2^{7}5\cdot19793\cdot53777\cdot1053071\cdot442405567$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-840$}
& $-2^{4}179\cdot347$ & $-2^{5}3\cdot61\cdot1597\cdot10103$ & $-2^{7}3\cdot5\cdot11^{2}90223100377$ & $-2^{8}3^{2}5\cdot7\cdot661\cdot709\cdot1511\cdot155380321$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-1012$}
& $-2^{7}3\cdot47\cdot2473$ & $-2^{4}16504437324451$ & $-2^{10}3^{2}7^{2}13\cdot4463\cdot145619278193$ & $-2^{7}1663\cdot93287\cdot115469\cdot37218419688193$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-1092$}
& $-2^{5}5\cdot17359$ & $-2^{5}3\cdot9721\cdot768881$ & $-2^{8}3\cdot167\cdot12647\cdot264316363$ & $-2^{8}3^{2}5\cdot7\cdot59\cdot241\cdot423292626320989$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-1320$}
& $-2^{4}47\cdot16069$ & $-2^{5}3\cdot47\cdot367\cdot6613879$ & $-2^{7}3\cdot5\cdot13\cdot6874687\cdot139706417$ & $-2^{8}3^{2}5\cdot103\cdot1867\cdot6737\cdot1468799\cdot4281731$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-1380$}
& $-2^{7}7\cdot16349$ & $-2^{5}3\cdot13\cdot97\cdot487\cdot287117$ & $-2^{10}3\cdot5\cdot31\cdot395027\cdot228192919$ & $-2^{8}3^{2}5\cdot18597324231281857131113$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-1428$}
& $-2^{11}79\cdot83$ & $-2^{5}3\cdot47\cdot8527\cdot382999$ & $-2^{15}3\cdot348685527772061$ & $-2^{8}3^{2}7\cdot11\cdot344171\cdot2964701350076467$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-1540$}
& $-2^{5}3\cdot59\cdot1747$ & $-2^{5}1289\cdot184546987$ & $-2^{8}3^{4}5\cdot13\cdot23\cdot421\cdot1169291867$ & $-2^{8}5\cdot7\cdot631\cdot16369\cdot39779\cdot14329084171$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-1848$}
& $-2^{4}37\cdot53\cdot2689$ & $-2^{5}3\cdot4820737472711$ & $-2^{7}3\cdot19\cdot659\cdot1693\cdot744556639889$ & $-2^{8}3^{2}7\cdot14447\cdot635872200295961350853$\\
\cline{2-6}
\multicolumn{1}{ |c| }{}& \multicolumn{1}{|c|}{$-5460$}
& $-2^{7}337\cdot27239$ & $-2^{6}3\cdot11\cdot127\cdot997\cdot2711\cdot59999$ & $-2^{10}3\cdot5\cdot29\cdot53\cdot109\cdot1490472400622759$ & $-2^{9}3^{2}5\cdot7\cdot859\cdot1070081\cdot2882267\cdot1549429199063$\\
\cline{1-6}
\end{tabular}

\subsection{$D=-23$: Class number 3, one genera}
In this section, we consider the case $K=\Q(\sqrt{-23})$, which has cyclic class group of order $3$ generated by one of the primes above $2$, say $\p_2$.

Using Corolary \ref{coro:factorpip} and the structure of the class group, we see that one only needs to compute
\[\langle\theta_{\p_2^i},\theta_{\O_K}\rangle\]
for $0\leq i\leq 2$ and since $\p_2^2\sim\bar{\p2}$ in the class group and $\langle\theta_{\bar{\p_2}},\theta_{\O_K}\rangle=\overline{\langle\theta_{\p_2},\theta_{\O_K}\rangle}$, we only care about $\langle\theta_{\p_2},\theta_{\O_K}\rangle$ and $\langle\theta_{\O_K},\theta_{\O_K}\rangle$.

We first look at the algebraic number
\[a(\ell)=V_D\langle\theta_{\O_K},\theta_{\O_K}\rangle/\Omega_K^{4\ell}.\]
For $\ell=1,2$ and $4$, we find that $a(\ell)^3$ is a root of a monic degree $3$ polynomial and generates the Hilbert class field over $K$. For example, we find that $a(1)$ is a root of the polynomial
\[x^9 - 2816x^6 - 905216x^3 - 89915392\]
and using the command $\texttt{polredbest}$ in PARI/GP we find that
\[x^3 - 2816x^2 - 905216x - 89915392\]
generates the Hilbert class field of $K$ (which is generated by the roots of $x^3-x-1$).
When $l=3,6$ and $9$, we find that $a(\ell)$ is a root of a cubic polynomial and gererates the Hilbert class field over $K$. For example, $a(3)$ is a root of
\[x^3 - 6740x^2 - 169034720x - 1027491892288.\]
Note that there seems to be a dependance on $\ell$ modulo $3$. Also, all these quantities are algebraic integers.

We now look at the algebraic number
\[b(\ell)=V_D\langle\theta_{\p_2},\theta_{\O_K}\rangle/\Omega_K^{4\ell}.\]
For $\ell=1,2$ and $4$, $b(\ell)^3$ is a root of a monic degree $6$ polynomial. For example, $b(1)$ is a root of
\[x^{18} + 19712x^{15} + 579022848x^{12} - 1231996846080x^9 + 2076139946246144x^6- 2333695837768515584x^3 + 2119375970242045935616.\]
For $\ell=3,6$ and $9$, $b(\ell)$ is a root of a degree $6$ polynomial. It is also the case that all the degree $6$ polynomials encountered when dealing with $b(\ell)$ generate the same number field as the polynomial
\[x^6 - 3x^5 + 5x^4 - 5x^3 + 5x^2 - 3x + 1.\]
So far, I didn't figure out where this polynomial comes from!

With this data, it is possible to compute the matrix $M_{\{\O_K,\p_2,\bar{\p_2}\}}$ and its determinant for small values of $\ell$. We find:

\begin{tabular}{|c|c|}
\hline
$\ell$ & $\det M_{\{\O_K,\p_2,\bar{\p_2}\}}(\ell)/\Omega_K^{12\ell}$ \\
\hline
$1$ & $-2^{10}23$ \\
\hline
$2$ & $-2^{14}19\cdot23\cdot619$ \\ 
\hline
$3$ & $-2^{18}5^{2}11\cdot23\cdot337\cdot27299$ \\ 
\hline
$4$ & $-2^{22}7^{2}23\cdot163\cdot2113\cdot117741979$ \\ 
\hline
$5$ & $-2^{26}5^{3}23\cdot229\cdot23761\cdot808991\cdot20338663$ \\ 
\hline
$6$ & $-2^{30}5^{2}11^{2}13\cdot19\cdot23\cdot67^{2}101\cdot868697\cdot505912247899$ \\ 
\hline
$7$ & $-2^{34}7^{3}23\cdot14139407\cdot865325441456416616320445873$ \\ 
\hline
$8$ & $-2^{38}5^{6}7^{2}23\cdot607158777765834221063650098382517444617$ \\ 
\hline
$9$ & $-2^{42}5^{2}11\cdot17^{2}23\cdot31\cdot53\cdot181\cdot1879\cdot2861\cdot319129\cdot620671\cdot12513856379\cdot245047645005307$ \\ 
\hline
$10$ & $-2^{46}5^{3}19^{2}23\cdot403229675409867947922039287854691275474649627654097637757$ \\
\hline
\end{tabular}

It is surprising at first that although the entries of the matrix $M_{\{\O_K,\p_2,\bar{\p_2}\}}$ are algebraic of high degree (up to $18$) and belong to different fields, the determinant is rational.

Next, we consider the algebraic quantities
\[N(\psi,\ell) = V_D\langle\theta_{\psi},\theta_{\psi}\rangle/\Omega_K^{4\ell}.\]
In this section, we only present the results. For more details on how to compute these quantities, in particular how to numerically evaluate the $L$-function attached to Hecke characters of quadratic fields, see the next chapter. For fixed $\ell$, let $\psi_0,\psi_1$ and $\psi_2$ be the Hecke characters of infinity type $2\ell$.

For $\ell=1,2,4$ and $5$, the numbers $N(\psi_i,\ell)$, for $0\leq i\leq 2$, are distinct and their cube are the three real roots of a monic cubic polynomial. For example, the numbers $N(\psi_i,1)^3$, for $0\leq i\leq 2$, are the three roots of the irreducible polynomial
\[x^3 - 6966x^2 + 11569230x - 239483061.\]
Note that the constant term is $621^3=(3^323)^3$, a perfect cube. It follows that the determinant of $M_K(\ell)$ is $621$, an integer.

For $\ell=3,6$ and $9$, the situation is slightly different. For one of the characters, suppose it is $\psi_0$, the algebraic number $N(\psi_0,\ell)$ is an \emph{integer}. For the two others, we find that their cube are the roots of a monic quadratic polynomial. For example,
\[N(\psi_0,3) = 5055 = 3\cdot5\cdot337\]
and $N(\psi_1,3)^3$ and $N(\psi_2,3)^3$ are the roots of
\[x^2 - 16287872873193x + 30021979248651078296845875.\]
Again, the constant term of this quadratic polynomial is a perfect cube.

In the following table, we compute the determinant of the matrix $M_K(\ell)$ for $1\leq \ell\leq 10$.

\begin{tabular}{|c|c|}
\hline
$\ell$ & $\det M_K(\ell)/\Omega_K^{12\ell}$ \\
\hline
$1$ & $-3^{3}23$ \\
\hline
$2$ & $-3^{3}19\cdot23\cdot619$ \\ 
\hline
$3$ & $-3^{3}5^{2}11\cdot23\cdot337\cdot27299$ \\ 
\hline
$4$ & $-3^{3}7^{2}23\cdot163\cdot2113\cdot117741979$ \\ 
\hline
$5$ & $-3^{3}5^{3}23\cdot229\cdot23761\cdot808991\cdot20338663$ \\ 
\hline
$6$ & $-3^{3}5^{2}11^{2}13\cdot19\cdot23\cdot67^{2}101\cdot868697\cdot505912247899$ \\ 
\hline
$7$ & $-3^{3}7^{3}23\cdot14139407\cdot865325441456416616320445873$ \\ 
\hline
$8$ & $-3^{3}5^{6}7^{2}23\cdot607158777765834221063650098382517444617$ \\ 
\hline
$9$ & $-3^{3}5^{2}11\cdot17^{2}23\cdot31\cdot53\cdot181\cdot1879\cdot2861\cdot319129\cdot620671\cdot12513856379\cdot245047645005307$ \\ 
\hline
$10$ & $-3^{3}5^{3}19^{2}23\cdot403229675409867947922039287854691275474649627654097637757$ \\
\hline
\end{tabular}

As one can see, the entries of the last two tables are very similar, but they differ by powers of $2$ and $3$. This is explained in part by our choice of representatives $\{\O_K,\p_2,\bar{\p_2}\}$ for the class group, since $\p_2$ has norm $2$ (recall that the matrix $M_\mathcal{R}(\ell)$ depends on the choice of representatives for the class group). The matrix $M_K(\ell)$ on the other hand depends only on $K$ and $\ell$ and so it makes sense to say that its determinant is an integer. It also seems that the Petersson norms of the $\theta_\psi$ exhibit a simpler structure, since their cube are the roots of a cubic polynomial when $\ell$ is not divisible by $3$. The fact that only one of the norms is an integral multiple $\Omega_k^{4\ell}$ when $3$ divides $\ell$ seems mysterious for the moment.

\subsection{$D=-56$: Class number $4$, two genera}
In this section, we consider the case $K=\Q(\sqrt{-56})$. The class group is cyclic of order $4$ and generated by a prime above $3$, say $\p_3$. Since $\Clk[2]=\{\O_K,\p_3^2\}$, there are two genera, each containing two classes. Let $\mathcal{G}_0=\{\O_K,\p_3^2\}$ be the principal genera and let $\mathcal{G}_1=\{\p_3,\p_3^3\}$ be the other one. The matrix $M_{\mathcal{G}_0\cup\mathcal{G}_1}(\ell)$ is of the form
\[\begin{pmatrix}
M_{\mathcal{G}_0}(\ell) & 0 \\ 
0 & M_{\mathcal{G}_1}(\ell)
\end{pmatrix},\]
with the obvious notation for $M_{\mathcal{G}_0}(\ell)$ and $M_{\mathcal{G}_1}(\ell)$. For $ell=1,\dots,10$, the quantities $\det(M_{\mathcal{G}_i}(\ell))/\Omega_K^{8\ell}$  are not integral, but their squares are. For example, $\det(M_{\mathcal{G}_0}(1))/\Omega_K^{8\ell}$ is a root of
\[x^2 - 2868031660032\]
and
$\det(M_{\mathcal{G}_0}(1))/\Omega_K^{8\ell}$ is a root of
\[x^2 - 18817155721469952.\]
Note that $18817155721469952=3^{8}2868031660032$, so that the product of the two normalized determinants is a rational integer.

Here we could present the computation of $\det(M_{\mathcal{G}_0\cup\mathcal{G}_1}(\ell))/\Omega_K^{16\ell}$, but as we saw in the previous section, it is preferable to analyse $\det(M_K(\ell))/\Omega_K^{16\ell}$. We find

\begin{tabular}{|c|c|}
\hline
$\ell$ & $\det(M_K(\ell))/\Omega_K^{16\ell}$ \\
\hline
$1$ & $-2^{13}3^{2}7^{2}11^{2}$ \\
\hline
$2$ & $-2^{19}3^{4}7^{2}61^{2}71^{2}$ \\ 
\hline
$3$ & $-2^{25}3^{2}7^{2}29^{2}31^{2}59^{2}2017^{2}$ \\ 
\hline
$4$ & $-2^{33}3^{2}7^{6}11^{2}83^{2}3691^{2}5939^{2}$ \\ 
\hline
$5$ & $-2^{41}3^{4}7^{6}11^{2}43^{2}2953^{2}3847^{2}35491^{2}$ \\ 
\hline
$6$ & $-2^{47}3^{2}7^{6}11^{2}13^{2}283^{2}1202321^{2}1613433383^{2}$ \\ 
\hline
$7$ & $-2^{53}3^{2}7^{10}11^{2}61^{2}2063^{2}28723^{2}9917842089143^{2}$ \\ 
\hline
$8$ & $-2^{63}3^{6}7^{10}97^{2}229^{2}643^{2}9137^{2}258491^{2}77699151157^{2}$ \\ 
\hline
$9$ & $-2^{73}3^{2}7^{10}17^{4}503^{2}2336281^{2}7131947^{2}9035729^{2}332046959^{2}$ \\ 
\hline
$10$ & $-2^{79}3^{2}7^{10}11^{2}23^{2}18356003^{2}23198867689^{2}57493729528723395587^{2}$ \\
\hline
\end{tabular}

Note that these values are perfect squares (away from the prime $2$). Since the norms of $\theta_\psi$ and $\theta_{\chi_0\psi}$, where $\chi_0$ is the non-trivial genus character, are equal by formula \ref{NormLpsi}, we have
\[\det(M_K(\ell))/\Omega_K^{16\ell}=(V_D^2\langle\theta_{\psi_0},\theta_{\psi_0}\rangle \langle\theta_{\psi_1},\theta_{\psi_1}\rangle)^2/\Omega_K^{16\ell},\]
where $\psi_0$ and $\psi_1$ were chosen so that $\psi_0/\psi_1$ is not a genus character. Interestingly, for $\ell=1,\dots,10$ one of $V_D\langle\theta_{\psi_i},\theta_{\psi_i}\rangle/\Omega_K^{4\ell}$ is an integer, while only the square of the other is an integer. For example, for $\ell=1$ we see that
\[V_D\langle\theta_{\psi_0},\theta_{\psi_0}\rangle/\Omega_K^{4\ell} = 168\]
while $V_D\langle\theta_{\psi_1},\theta_{\psi_1}\rangle/\Omega_K^{4\ell}$ is a root of
\[x^2 - 15488.\]
It is also interesting to note that for those values of $\ell$, whenever $V_D\langle\theta_{\psi_0},\theta_{\psi_0}\rangle/\Omega_K^{4\ell}$ is not an integer, it generates the genus field $\Q(\sqrt{2})$ over $K$. For example, the roots of $x^2 - 15488$ are $\pm2^{3}11\sqrt{2}$.

\subsection{$D=-47$: Class number $5$, one genera}
In this section , we consider the case $K=\Q(\sqrt{-47})$. Then the class group is cyclic of order $5$, so there is only one genera (of course, this last assertion also follows directly from the fact that $K$ has prime discriminant).

Here we will only analyse the algebraic quantities
\[N(\psi,\ell) = V_D\langle\theta_{\psi},\theta_{\psi}\rangle/\Omega_K^{4\ell}.\]
These quantities have a similar behaviour as in the case of $\Q(\sqrt{-23})$. Indeed for $\ell=1,2,3$ and $4$, the numbers $N(\psi_i,\ell)^5$ are the (distinct) roots of a degree $5$ polynomial. For example, the numbers $N(\psi_i,\ell)^5$ are the roots of
\[x^5 - 101253156250x^4 +\dots- 45258661022880985938603887557983398437500000.\]
When $\ell=5$ or $10$, one of the $N(i,\ell)$ is an integer and the fifth power of the four others are roots of a degree $4$ polynomial. For example, after possibly reordering the characters
\[N(\psi_0,5) = 29975233350\]
and the $N(\psi_i,5)^5$, for $1\leq i\leq 4$, are the roots of a degree $4$ polynomial with constant term an integer with more than $200$ digits. The following table presents the results of some of our computations.








\begin{tabular}{|c|c|}
\hline
$\ell$ & $\det(M_K(\ell))/\Omega_K^{20\ell}$ \\
\hline
$1$ & $-2^{15}3^{5}13\cdot47^{2}$ \\
\hline
$2$ & $-2^{19}3^{9}47^{2}11603669741$ \\ 
\hline
$3$ & $-2^{23}3^{15}5^{4}47^{2}127354310913222293$ \\ 
\hline
$4$ & $-2^{27}3^{17}47^{2}149\cdot337\cdot9277\cdot1834295147\cdot1265152984726999$ \\ 
\hline
$5$ & $-2^{31}3^{21}5^{5}43\cdot47^{2}131\cdot1061\cdot4647323\cdot249292661\cdot271992631\cdot3048996951349$ \\ 
\hline
$6$ & $-2^{35}3^{26}5^{4}11^{4}41\cdot47^{2}433\cdot27299\cdot982047751879879\cdot168268707618022171794075861451$ \\ 
\hline
\end{tabular}

We stop at $\ell=6$ because the numbers become too large to write down (and hard to factor). Indeed for $\ell=7$ and over, the quantity $\det(M_K(\ell))/\Omega_K^{20\ell}$ is an integer with more than $100$ digits.

\subsection{$D=-104$}

\subsection{$D=-2660$}

\section{Computing some special values of Hecke $L$-functions}
Use formula for $D=-23$ and infinity type 2. Show how formula \ref{eq:Heckespecialvalues2} fits into Deligne's conjectures (see Watkins sec. 5.3.2).


\begin{thebibliography}{DDDD}%
	\bibitem[Cohe]{Cohe}
    {\scshape\itshape Cohen, H.}, \emph{Number Theory, Volume II: Analytic and Modern Tools}, Springer Graduate Texts in Mathematics, 2007.

    \bibitem[DiSh]{DiSh}
    {\scshape\itshape Diamond, F., Shurman, J.}, \emph{A First Course in Modular Forms}, Springer Graduate Texts in Mathematics, 2005.
    
    \bibitem[Iwan]{Iwan}
	{\scshape\itshape Iwaniec, H.}, \emph{Topics in Classical Automorphic Forms}, Graduate Studies in Mathematics, Volume 17, American Mathematical Society, Providence, 1991.
	
	\bibitem[Miya]{Miya}
    {\scshape\itshape Miyake, T.}, \emph{Modular Forms}, Springer Monographs in Mathematics, 2006.
    
    \bibitem[Shi1]{Shi1}
    {\scshape\itshape Shimura, G.}, \emph{Elementary Dirichlet Series
and Modular Forms}, Springer Monographs in Mathematics, 2007.
    
    \bibitem[Shi2]{Shi2}
    {\scshape\itshape Shimura, G.}, \emph{On the Holomorphy of Certain Dirichlet Series}, Proc. London Math. Soc. (3) 31 (1975), 79-98.

	\bibitem[Shi3]{Shi3}
    {\scshape\itshape Shimura, G.}, \emph{The special Values of the Zeta Functions Associated with Cusp Forms}, Communications on Pure and Applied Mathematics, Vol. XXIX, 1976.
    
	\bibitem[Zag]{Zag}
    {\scshape\itshape Zagier, D.}, \emph{Elliptic modular forms and their applications} in \emph{1-2-3 of Modular Forms}, Universitext, Springer-Verlag Berlin Heidelberg, 2008.
\end{thebibliography}
\end{document}

